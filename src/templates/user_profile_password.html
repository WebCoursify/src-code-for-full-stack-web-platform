{% extends 'user_profile_base.html' %}

{% block form %}
	<h1>Change Password</h1>
	<hr/>
	<form class="form-horizontal" role="form" id="profile-update-password" action="/api/password/update"
		method="POST">

	    <div class="form-group">
	        <label for="title" class="col-sm-2 control-label">Original password</label>
	        <div class="col-sm-10">
	            <input type="password" class="form-control" name="original_password"
	            value="" required>
	        </div>
	    </div>

	    <div class="form-group">
	        <label for="title" class="col-sm-2 control-label">New password</label>
	        <div class="col-sm-10">
	            <input type="password" class="form-control" name="new_password"
	            value="" required>
	        </div>
	    </div>

	    <div class="form-group">
	        <label for="title" class="col-sm-2 control-label">Repeat new password</label>
	        <div class="col-sm-10">
	            <input type="password" class="form-control" name="new_password_repeat"
	            value="" required>
	        </div>
	    </div>


	    <div class="form-group">
	        <div class="col-sm-offset-2 col-sm-10">
	            <button type="submit" class="btn btn-default">Save</button>
	        </div>
	    </div>
	</form>

{% endblock %}

{% block user_profile_script %}
<script type="text/javascript">
$('#profile-update-password').ajaxForm({
	beforeSubmit: function(arr, form, option){
		var new_password, new_password_repeat;
		arr.forEach(function(item){
			if(item.name == 'new_password')
				new_password = item.value;
			else if(item.name == 'new_password_repeat')
				new_password_repeat = item.value;
		});
		if(!new_password || !new_password_repeat || new_password != new_password_repeat){
			alert('The two passwords must be non-empty and identical');
			return false;
		}
	},
	success: function(res){
		if(res.error)
			alert(res.error);
		else{
			alert('Password successfully updated!')
			window.location.reload();
		}
	},
	error: function(e){
		alert('Internal server error');
		console.log(e);
	},
	dataType: 'json'
});
</script>
{% endblock %}